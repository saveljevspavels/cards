<div class="activity" id="activity-{{activity.id}}">
    <ng-container *ngIf="collapsible">
        <ng-container [ngTemplateOutlet]="collapsibleActivityTemplate" [ngTemplateOutletContext]="{activity: activity}"></ng-container>
    </ng-container>
    <ng-container *ngIf="!collapsible">
        <ng-container [ngTemplateOutlet]="activityTemplate" [ngTemplateOutletContext]="{activity: activity}"></ng-container>
    </ng-container>
</div>

<ng-template #activityTemplate>
    <ng-container *ngTemplateOutlet="headerTemplate"></ng-container>
    <ng-container *ngTemplateOutlet="contentTemplate"></ng-container>
</ng-template>

<ng-template #collapsibleActivityTemplate>
    <app-collapsible [customHeader]="true">
        <ng-container headerContent *ngTemplateOutlet="headerTemplate"></ng-container>
        <ng-container hiddenContent *ngTemplateOutlet="contentTemplate"></ng-container>
    </app-collapsible>
</ng-template>

<ng-template #headerTemplate>
    <div class="box p-2 d-flex justify-content-between align-items-center"
         [ngClass]="{'mb-2': activity.gameData?.cardSnapshots.length}"
    >
        <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
                <app-athlete *ngIf="activity?.athlete" [size]="'medium'"
                             [athleteId]="activity?.athlete.id"
                >
                    <div class="d-flex align-items-center mt-0-5">
                        <app-activity-type-icon [type]="activityType"
                                                [width]="14"
                                                [height]="14"
                        >
                        </app-activity-type-icon>
                        <span class="m-0 ml-1 text-small text-bold">{{activity[validationService.baseActivityTypeMap.get(activityType)] | activityProp : validationService.baseActivityTypeMap.get(activityType)}}</span>
                    </div>
                </app-athlete>
            </div>
        </div>
        <div class="d-flex justify-content-between flex-column align-items-end">
            <app-strava-link [activityId]="activity.id"></app-strava-link>
            <app-link *ngIf="activity.map?.summary_polyline;" [text]="'View Map'" (click)="showMap()"></app-link>
        </div>
    </div>
    <app-entity-id [id]="activity.id"></app-entity-id>
</ng-template>

<ng-template #mapViewPopup>
    <div class="popup box">
        <app-swiper [polyline]="activity.map?.summary_polyline"
                    [activityType]="activityType"
        ></app-swiper>
    </div>
</ng-template>

<ng-template #contentTemplate>
    <div *ngFor="let card of activity.gameData?.cardSnapshots; trackBy: cardTrackBy" class="box p-2 mb-2">
        <app-card-snapshot [card]="card"
                           [activity]="activity"
                           [activityType]="activityType"
                           [showReports]="showReports"
                           (liked)="like($event)"
                           (reported)="report($event)"
                           (openComments)="openComments($event)"
        >

        </app-card-snapshot>
    </div>
</ng-template>

<ng-template #commentsPopup>
    <app-comment-view [activity]="activity"
                      [card]="selectedCard"
                      (closeComments)="closeComments()"
    ></app-comment-view>
</ng-template>
