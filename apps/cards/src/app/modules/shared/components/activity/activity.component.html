<div class="activity">
    <ng-container *ngIf="collapsible">
        <ng-container [ngTemplateOutlet]="collapsibleActivityTemplate" [ngTemplateOutletContext]="{activity: activity}"></ng-container>
    </ng-container>
    <ng-container *ngIf="!collapsible">
        <ng-container [ngTemplateOutlet]="activityTemplate" [ngTemplateOutletContext]="{activity: activity}"></ng-container>
    </ng-container>
</div>

<ng-template #activityTemplate>
    <ng-container *ngTemplateOutlet="headerTemplate"></ng-container>
    <ng-container *ngTemplateOutlet="contentTemplate"></ng-container>
</ng-template>

<ng-template #collapsibleActivityTemplate>
    <app-collapsible [customHeader]="true">
        <ng-container headerContent *ngTemplateOutlet="headerTemplate"></ng-container>
        <ng-container hiddenContent *ngTemplateOutlet="contentTemplate"></ng-container>
    </app-collapsible>
</ng-template>

<ng-template #headerTemplate>
    <div class="d-flex align-items-center mb-2">
        <app-athlete *ngIf="activity?.athlete" [size]="'small'" [athleteId]="activity?.athlete.id"></app-athlete>
        <span class="text-small ml-1">
            {{activityVerbMap.get(activityType)}} <span class="text-bold">{{activity[validationService.baseActivityTypeMap.get(activityType)] | activityProp : validationService.baseActivityTypeMap.get(activityType)}}</span>
        </span>
    </div>
</ng-template>


<ng-template #contentTemplate>
    <div *ngFor="let card of activity.gameData?.cardSnapshots" class="box p-1 mb-2">
        <div class="d-flex align-items-center justify-content-between mb-1">
            <div class="d-flex align-items-center">
                <app-athlete *ngIf="activity?.athlete" [size]="'small'" [athleteId]="activity?.athlete.id"></app-athlete>
                &nbsp;
                <span class="text-small">completed <span class="text-bold">"{{card.title}}"</span></span>
            </div>
            <app-image [src]="card.image" class="mr-1" [small]="true"></app-image>
        </div>
        <app-gallery [images]="card.attachedImages"
                     [polyline]="activity.map?.summary_polyline"
                     [activityType]="activityType"
        ></app-gallery>
    </div>
</ng-template>