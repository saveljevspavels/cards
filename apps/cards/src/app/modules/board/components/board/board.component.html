<app-header></app-header>

<app-content>
    <app-rules></app-rules>
    <div class="row">
        <div class="col-lg-6">
            <div *ngIf="selectedActivity | async; else selectionMode">
                <h3>Submitting Activity</h3>
                Please select cards to play, add images/comments

                <app-activity [activity]="selectedActivity | async"></app-activity>

                <p>Upload images, if card requires it</p>
                <app-image-upload
                    [formControl]="form.get('selectedImages')"
                ></app-image-upload>

                <app-textarea
                    rows="4"
                    styleClass="full-width mt-3"
                    [label]="'Comments'"
                    [fc]="form.get('comments')"></app-textarea>

                <div class="row mt-3">
                    <div class="col-md-6">
                        <p-button styleClass="full-width" [disabled]="!form.get('selectedCards').value.length" (click)="submitSelectedActivity()" label="Submit"></p-button>
                    </div>
                    <div class="col-md-6">
                        <p-button styleClass="p-button-danger full-width" (click)="exitSubmitMode()" label="Cancel"></p-button>
                    </div>
                </div>
            </div>
            <ng-template #selectionMode>
                <div>
                    <h3>Your Pending Activities</h3>
                    <app-selection-wrapper
                        [singleSelection]="true"
                        [formControl]="form.get('selectedActivity')"
                        [template]="activityTemplate"
                        [selfSelectable]="true"
                        [dataItems]="(newActivities | async)"
                        [idKey]="'id'"
                    >
                        <ng-template #activityTemplate let-dataItem="dataItem">
                            <app-activity
                                [activity]="dataItem"
                                [showComments]="true"
                            ></app-activity>
                            <p-button *ngIf="dataItem.gameData.status === 'submitted'" (click)="rejectActivity(dataItem.id)" styleClass="p-button-danger" label="Cancel Submission"></p-button>
                        </ng-template>
                    </app-selection-wrapper>
                </div>
            </ng-template>
        </div>
        <div class="col-lg-6">
            <app-card-queue [formControl]="form.get('selectedCards')"></app-card-queue>
        </div>
    </div>
</app-content>
